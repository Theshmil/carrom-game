<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Carrom Pool</title>
<style>
  body {
    margin: 0;
    background: #111;
    color: #fff;
    font-family: sans-serif;
    text-align: center;
  }
  canvas {
    background: #d2b48c;
    border: 8px solid #fff;
    border-radius: 20px;
    touch-action: none;
  }
  #menu {
    margin-top: 50px;
  }
  #menu button {
    margin: 10px;
    padding: 15px 30px;
    font-size: 20px;
    background: #fff;
    color: #000;
    border: none;
    border-radius: 10px;
    cursor: pointer;
  }
  #winMessage {
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.8);
    padding: 20px;
    border-radius: 10px;
    font-size: 24px;
    display: none;
  }
</style>
</head>
<body>
<h1>Carrom Pool</h1>
<div id="menu">
  <button onclick="startGame('local')">Local Multiplayer</button>
  <button onclick="startGame('ai')">Play vs AI ðŸ¤–</button>
</div>
<canvas id="gameCanvas" width="400" height="400" style="display:none;"></canvas>
<div id="winMessage">ðŸŽ‰ You Win! <button onclick="restartGame()">Play Again</button></div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let striker = {x: 200, y: 360, r: 10, vx: 0, vy: 0};
let pucks = [];
let dragging = false;
let dragStart = null;
let dragEnd = null;
let mode = '';

function initPucks() {
  pucks = [];
  const positions = [
    {x:200,y:200},{x:215,y:200},{x:185,y:200},
    {x:200,y:215},{x:200,y:185},{x:215,y:215},
    {x:185,y:185},{x:215,y:185},{x:185,y:215}
  ];
  positions.forEach((pos,i)=>{
    pucks.push({x:pos.x,y:pos.y,r:8,color:(i==0?'red':i%2==0?'white':'black'),vx:0,vy:0});
  });
}

function restartGame(){
  striker.x=200; striker.y=360; striker.vx=0; striker.vy=0;
  initPucks();
  document.getElementById('winMessage').style.display='none';
}

function startGame(selectedMode){
  mode = selectedMode;
  document.getElementById('menu').style.display='none';
  canvas.style.display='block';
  restartGame();
}

function isOnStriker(x,y){
  return Math.hypot(x - striker.x, y - striker.y) < striker.r+10;
}

function getPos(e){
  const rect=canvas.getBoundingClientRect();
  if(e.touches) e=e.touches[0];
  return {x: e.clientX - rect.left, y: e.clientY - rect.top};
}

// Mouse & touch events
canvas.addEventListener('mousedown',e=>{
  let pos=getPos(e);
  if(isOnStriker(pos.x,pos.y)){ dragging=true; dragStart=pos; dragEnd=pos; }
});
canvas.addEventListener('mousemove',e=>{
  if(dragging) dragEnd=getPos(e);
});
canvas.addEventListener('mouseup',e=>{
  if(dragging){ shootStriker(); }
  dragging=false;
});
canvas.addEventListener('touchstart',e=>{
  let pos=getPos(e);
  if(isOnStriker(pos.x,pos.y)){ dragging=true; dragStart=pos; dragEnd=pos; }
});
canvas.addEventListener('touchmove',e=>{
  if(dragging){ dragEnd=getPos(e); e.preventDefault(); }
});
canvas.addEventListener('touchend',e=>{
  if(dragging){ shootStriker(); }
  dragging=false;
});

function shootStriker(){
  const dx=dragEnd.x - dragStart.x;
  const dy=dragEnd.y - dragStart.y;
  const len=Math.hypot(dx,dy);
  if(len>5){
    striker.vx=-(dx/len)*6;
    striker.vy=-(dy/len)*6;
  }
}

// collision between two circles
function collide(a,b){
  let dx=b.x - a.x;
  let dy=b.y - a.y;
  let dist=Math.hypot(dx,dy);
  if(dist< a.r+b.r){
    let overlap = (a.r+b.r-dist)/2;
    let nx=dx/dist, ny=dy/dist;
    a.x -= nx*overlap; a.y -= ny*overlap;
    b.x += nx*overlap; b.y += ny*overlap;
    let kx=a.vx - b.vx;
    let ky=a.vy - b.vy;
    let p = 2*(nx*kx+ny*ky)/2;
    a.vx -= p*nx;
    a.vy -= p*ny;
    b.vx += p*nx;
    b.vy += p*ny;
  }
}

function physics(){
  [striker,...pucks].forEach(obj=>{
    obj.x+=obj.vx; obj.y+=obj.vy;
    obj.vx*=0.98; obj.vy*=0.98;

    // bounce from walls
    if(obj.x<obj.r||obj.x>400-obj.r) obj.vx*=-1;
    if(obj.y<obj.r||obj.y>400-obj.r) obj.vy*=-1;
  });

  // striker vs pucks
  pucks.forEach(p=>collide(striker,p));

  // puck vs puck
  for(let i=0;i<pucks.length;i++)
    for(let j=i+1;j<pucks.length;j++)
      collide(pucks[i],pucks[j]);

  // pockets
  pucks = pucks.filter(p=>{
    if([0,400].some(px=>[0,400].some(py=>Math.hypot(p.x-px,p.y-py)<20))){
      return false;
    }
    return true;
  });

  if(pucks.length==0){
    document.getElementById('winMessage').style.display='block';
  }
}

function drawBoard(){
  // board background already set
  // center circle
  ctx.beginPath(); ctx.arc(200,200,50,0,Math.PI*2);
  ctx.strokeStyle='brown'; ctx.lineWidth=2; ctx.stroke();

  // cross lines
  ctx.strokeStyle='brown';
  ctx.beginPath();
  ctx.moveTo(0,0); ctx.lineTo(400,400);
  ctx.moveTo(400,0); ctx.lineTo(0,400);
  ctx.stroke();
}

function draw(){
  ctx.clearRect(0,0,400,400);
  drawBoard();

  // draw pockets
  [0,400].forEach(x=>[0,400].forEach(y=>{
    ctx.beginPath(); ctx.arc(x,y,20,0,Math.PI*2);
    ctx.fillStyle='#000'; ctx.fill();
  }));

  // draw pucks
  pucks.forEach(p=>{
    ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle=p.color; ctx.fill();
  });

  // draw striker
  ctx.beginPath(); ctx.arc(striker.x,striker.y,striker.r,0,Math.PI*2);
  ctx.fillStyle='navy'; ctx.fill();

  // drag line
  if(dragging){
    ctx.beginPath();
    ctx.moveTo(striker.x,striker.y);
    ctx.lineTo(dragEnd.x,dragEnd.y);
    ctx.strokeStyle='yellow'; ctx.stroke();
  }
}

function loop(){
  if(mode){ physics(); draw(); }
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
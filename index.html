<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mini Carrom Game</title>
<style>
  body {
    margin: 0;
    background: #deb887;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    color: #4b2e2e;
    margin: 10px;
  }
  canvas {
    border: 12px solid #8b4513;
    border-radius: 5px;
    background: #fce5cd;
    display: none;
  }
  #score, #win, #menu {
    font-size: 1.2em;
    margin: 5px;
    color: #4b2e2e;
  }
  button {
    margin: 5px;
    padding: 10px 20px;
    background: #8b4513;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1em;
    cursor: pointer;
  }
  button:hover {
    background: #a0522d;
  }
</style>
</head>
<body>

<h1>ðŸŽ± Mini Carrom Game ðŸŽ±</h1>

<div id="menu">
  <button onclick="startGame('local')">Local Multiplayer</button>
  <button onclick="startGame('ai')">Play vs AI (coming soon)</button>
</div>

<div id="score" style="display:none;">Score: 0</div>
<canvas id="canvas" width="400" height="400"></canvas>
<div id="win" style="display:none;">
  <p>ðŸŽ‰ You Win! ðŸŽ‰</p>
  <button onclick="restartGame()">Restart</button>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const menuEl = document.getElementById('menu');
const winEl = document.getElementById('win');

let striker, coins, allBalls, score, aiming, aimX, aimY, gameMode;

function startGame(mode){
  gameMode = mode;
  score=0;
  striker = { x: 200, y: 350, radius: 12, dx:0, dy:0, color:'navy' };
  coins = [];

  // Red coin in center
  coins.push({ x:200, y:200, radius:10, dx:0, dy:0, color:'red' });

  // Arrange 9 coins around center in circle
  let colors = ['white','white','white','white','#2f2f2f','#2f2f2f','#2f2f2f','#2f2f2f','white'];
  let angleStep = (2*Math.PI)/colors.length;
  let r=25;
  for(let i=0;i<colors.length;i++){
    let angle = i*angleStep;
    coins.push({ x:200+Math.cos(angle)*r, y:200+Math.sin(angle)*r, radius:10, dx:0, dy:0, color:colors[i] });
  }

  allBalls = [striker, ...coins];
  aiming = false;
  menuEl.style.display='none';
  winEl.style.display='none';
  canvas.style.display='block';
  scoreEl.style.display='block';
  loop();
}

function restartGame(){
  startGame(gameMode);
}

canvas.onmousedown = e => { aiming = true; aimX=e.offsetX; aimY=e.offsetY; };
canvas.onmouseup = e => {
  if(aiming){
    aiming=false;
    let dx = e.offsetX - striker.x;
    let dy = e.offsetY - striker.y;
    let angle = Math.atan2(dy, dx);
    let fixedSpeed = 6;
    striker.dx = Math.cos(angle)*fixedSpeed;
    striker.dy = Math.sin(angle)*fixedSpeed;
  }
};

function collide(b1, b2){
  let dx=b2.x-b1.x;
  let dy=b2.y-b1.y;
  let dist=Math.hypot(dx,dy);
  let minDist=b1.radius+b2.radius;
  if(dist<minDist && dist>0){
    let overlap = (minDist - dist) / 2;
    let nx = dx/dist;
    let ny = dy/dist;
    b1.x -= nx*overlap;
    b1.y -= ny*overlap;
    b2.x += nx*overlap;
    b2.y += ny*overlap;

    let vx=b1.dx - b2.dx;
    let vy=b1.dy - b2.dy;
    let dot= vx*nx + vy*ny;
    b1.dx -= dot*nx;
    b1.dy -= dot*ny;
    b2.dx += dot*nx;
    b2.dy += dot*ny;
  }
}

function update() {
  allBalls.forEach(ball=>{
    ball.x += ball.dx;
    ball.y += ball.dy;
    ball.dx *=0.98;
    ball.dy *=0.98;
    if(Math.abs(ball.dx)<0.05) ball.dx=0;
    if(Math.abs(ball.dy)<0.05) ball.dy=0;

    if(ball.x - ball.radius < 0){ ball.x=ball.radius; ball.dx=-ball.dx; }
    if(ball.x + ball.radius > 400){ ball.x=400-ball.radius; ball.dx=-ball.dx; }
    if(ball.y - ball.radius < 0){ ball.y=ball.radius; ball.dy=-ball.dy; }
    if(ball.y + ball.radius > 400){ ball.y=400-ball.radius; ball.dy=-ball.dy; }
  });

  for(let i=0;i<allBalls.length;i++){
    for(let j=i+1;j<allBalls.length;j++){
      collide(allBalls[i], allBalls[j]);
    }
  }

  let pockets = [[0,0],[400,0],[0,400],[400,400]];
  coins = coins.filter(c=>{
    let pocketed=false;
    pockets.forEach(p=>{
      if(Math.hypot(c.x-p[0],c.y-p[1])<28){ pocketed=true; score+=1; }
    });
    return !pocketed;
  });
  allBalls = [striker, ...coins];
  scoreEl.innerText="Score: "+score;

  if(coins.length===0){
    canvas.style.display='none';
    scoreEl.style.display='none';
    winEl.style.display='block';
  }
}

function drawBoard(){
  ctx.clearRect(0,0,400,400);

  // Outer square
  ctx.strokeStyle='#8b4513';
  ctx.lineWidth=4;
  ctx.strokeRect(20,20,360,360);

  // Inner square
  ctx.strokeStyle='#a0522d';
  ctx.lineWidth=2;
  ctx.strokeRect(60,60,280,280);

  // Center circle
  ctx.beginPath();
  ctx.arc(200,200,20,0,Math.PI*2);
  ctx.stroke();

  // Cross lines
  ctx.beginPath();
  ctx.moveTo(200,60); ctx.lineTo(200,340);
  ctx.moveTo(60,200); ctx.lineTo(340,200);
  ctx.stroke();

  // Decorative circles
  ctx.fillStyle='black';
  [[0,0],[400,0],[0,400],[400,400]].forEach(p=>{
    ctx.beginPath();
    ctx.arc(p[0],p[1],28,0,Math.PI*2);
    ctx.fill();
  });
}

function draw(){
  drawBoard();
  coins.forEach(c=>{
    ctx.beginPath();
    ctx.arc(c.x,c.y,c.radius,0,Math.PI*2);
    ctx.fillStyle=c.color;
    ctx.fill();
  });
  ctx.beginPath();
  ctx.arc(striker.x,striker.y,striker.radius,0,Math.PI*2);
  ctx.fillStyle=striker.color;
  ctx.fill();

  if(aiming){
    ctx.strokeStyle='blue';
    ctx.beginPath();
    ctx.moveTo(striker.x,striker.y);
    ctx.lineTo(aimX,aimY);
    ctx.stroke();
  }
}

function loop(){
  if(coins.length>0){
    update();
    draw();
    requestAnimationFrame(loop);
  }
}
</script>

</body>
</html>
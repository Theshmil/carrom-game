<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Carrom Game</title>
<style>
  body {
    margin: 0;
    background: #3e2723;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #fff;
    font-family: sans-serif;
  }
  h1 {
    margin: 10px;
  }
  canvas {
    background: radial-gradient(#deb887, #a0522d);
    border: 8px solid #5d4037;
    border-radius: 20px;
  }
  .menu {
    margin: 10px;
  }
  .menu button {
    margin: 5px;
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    background: #795548;
    color: white;
    cursor: pointer;
  }
  .menu button:hover {
    background: #5d4037;
  }
</style>
</head>
<body>
<h1>Carrom</h1>
<div class="menu">
  <button onclick="startGame('local')">Local Play</button>
  <button onclick="startGame('ai')">AI ðŸ¤–</button>
  <button onclick="alert('Created by Treadmil and Sofa')">About</button>
</div>
<canvas id="gameCanvas" width="500" height="500"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let striker = { x: 250, y: 450, radius: 12, dx: 0, dy: 0, color: "#222", aiming: false };
let pucks = [];
let dragging = false;
let dragStart = null;
let guideLine = null;

function initBoard() {
  pucks = [];
  const center = { x: 250, y: 250 };
  const radius = 14;
  // Add red puck (queen)
  pucks.push({ x: center.x, y: center.y, radius, color: "red", dx: 0, dy: 0 });
  // Add black pucks
  for (let i = 0; i < 4; i++)
    pucks.push({ x: center.x + (i - 1.5) * 30, y: center.y - 30, radius, color: "black", dx: 0, dy: 0 });
  // Add white pucks
  for (let i = 0; i < 4; i++)
    pucks.push({ x: center.x + (i - 1.5) * 30, y: center.y + 30, radius, color: "white", dx: 0, dy: 0 });
  striker.x = 250; striker.y = 450;
  striker.dx = striker.dy = 0;
}

function drawBoard() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  // Draw pockets
  let pocketSize = 30;
  const pockets = [
    [0,0],[500,0],[0,500],[500,500]
  ];
  ctx.fillStyle = "#000";
  pockets.forEach(([x,y]) => ctx.beginPath(), ctx.arc(x, y, pocketSize, 0, Math.PI*2), ctx.fill());
  // Draw guide line
  if (dragging && dragStart) {
    ctx.strokeStyle = "rgba(255,255,255,0.6)";
    ctx.beginPath();
    ctx.moveTo(striker.x, striker.y);
    ctx.lineTo(guideLine.x, guideLine.y);
    ctx.stroke();
  }
}

function drawPuck(p) {
  const gradient = ctx.createRadialGradient(p.x - p.radius/3, p.y - p.radius/3, p.radius/4, p.x, p.y, p.radius);
  gradient.addColorStop(0, "white");
  gradient.addColorStop(1, p.color);
  ctx.fillStyle = gradient;
  ctx.beginPath();
  ctx.arc(p.x, p.y, p.radius, 0, Math.PI*2);
  ctx.fill();
}

function draw() {
  drawBoard();
  pucks.forEach(drawPuck);
  drawPuck(striker);
}

function update() {
  // Move pucks and striker
  [...pucks, striker].forEach(p => {
    p.x += p.dx;
    p.y += p.dy;
    // Friction
    p.dx *= 0.98;
    p.dy *= 0.98;
    // Stop small movement
    if (Math.abs(p.dx) < 0.1) p.dx = 0;
    if (Math.abs(p.dy) < 0.1) p.dy = 0;
    // Bounce from walls
    if (p.x - p.radius < 0 || p.x + p.radius > 500) p.dx = -p.dx;
    if (p.y - p.radius < 0 || p.y + p.radius > 500) p.dy = -p.dy;
  });
  // Simple collisions
  for (let i=0; i<pucks.length; i++) {
    let p = pucks[i];
    let dx = striker.x - p.x, dy = striker.y - p.y;
    let dist = Math.hypot(dx,dy);
    if (dist < striker.radius + p.radius) {
      let angle = Math.atan2(dy,dx);
      let speed = 4;
      p.dx = -Math.cos(angle) * speed;
      p.dy = -Math.sin(angle) * speed;
      striker.dx = Math.cos(angle) * speed;
      striker.dy = Math.sin(angle) * speed;
    }
  }
  draw();
  requestAnimationFrame(update);
}

canvas.addEventListener("mousedown", e => {
  dragging = true;
  dragStart = { x: e.offsetX, y: e.offsetY };
});
canvas.addEventListener("mousemove", e => {
  if (dragging) guideLine = { x: e.offsetX, y: e.offsetY };
});
canvas.addEventListener("mouseup", e => {
  if (dragging && guideLine) {
    let dx = guideLine.x - striker.x;
    let dy = guideLine.y - striker.y;
    striker.dx = dx * 0.1;
    striker.dy = dy * 0.1;
  }
  dragging = false;
  guideLine = null;
});

function startGame(mode) {
  initBoard();
}

startGame('local'); // default
update();
</script>
</body>
</html>
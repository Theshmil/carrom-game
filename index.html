<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Carrom Game</title>
<style>
  body {
    margin: 0;
    background: linear-gradient(120deg, #2c2c2c, #1a1a1a);
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #fff;
    font-family: 'Segoe UI', Tahoma, sans-serif;
  }
  h1 {
    margin: 20px;
    color: #f5deb3;
    font-size: 2em;
  }
  canvas {
    border: 12px solid #8b4513;
    border-radius: 8px;
    background: #deb887;
    display: none;
    box-shadow: 0 0 20px #000;
  }
  #score, #win {
    font-size: 1.5em;
    margin: 10px;
    color: #fff;
  }
  #menu {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 50px;
  }
  #menu button, #win button {
    margin: 10px;
    padding: 15px 30px;
    background: #fff;
    color: #000;
    border: none;
    border-radius: 8px;
    font-size: 1.2em;
    cursor: pointer;
    transition: background 0.3s, color 0.3s;
  }
  #menu button:hover, #win button:hover {
    background: #000;
    color: #fff;
    border: 1px solid #fff;
  }
</style>
</head>
<body>

<h1>Carrom Game</h1>

<div id="menu">
  <button onclick="startGame('local')">Play Local Multiplayer</button>
  <button onclick="startGame('ai')">Play vs AI (coming soon)</button>
</div>

<div id="score" style="display:none;">Score: 0</div>
<canvas id="canvas" width="400" height="400"></canvas>
<div id="win" style="display:none;">
  <p>ðŸŽ‰ You Win! ðŸŽ‰</p>
  <button onclick="restartGame()">Restart</button>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const menuEl = document.getElementById('menu');
const winEl = document.getElementById('win');

let striker, coins, allBalls, score, dragging, dragStart, gameMode;

function startGame(mode){
  gameMode = mode;
  score=0;
  striker = { x: 200, y: 350, radius: 12, dx:0, dy:0, color:'#fff', border:'#003366' };
  coins = [];

  // Red coin in center
  coins.push({ x:200, y:200, radius:10, dx:0, dy:0, color:'red' });

  // Arrange 9 coins in circle
  let colors = ['white','white','white','white','#000','#000','#000','#000','white'];
  let angleStep = (2*Math.PI)/colors.length;
  let r=25;
  for(let i=0;i<colors.length;i++){
    let angle = i*angleStep;
    coins.push({ x:200+Math.cos(angle)*r, y:200+Math.sin(angle)*r, radius:10, dx:0, dy:0, color:colors[i] });
  }

  allBalls = [striker, ...coins];
  dragging = false;
  menuEl.style.display='none';
  winEl.style.display='none';
  canvas.style.display='block';
  scoreEl.style.display='block';
  loop();
}

function restartGame(){
  startGame(gameMode);
}

canvas.onmousedown = e => {
  if(Math.hypot(e.offsetX - striker.x, e.offsetY - striker.y) < striker.radius+10){
    dragging = true;
    dragStart = { x: e.offsetX, y: e.offsetY };
  }
};
canvas.onmousemove = e => {
  if(dragging){
    dragStart = { x: e.offsetX, y: e.offsetY };
  }
};
canvas.onmouseup = e => {
  if(dragging){
    dragging = false;
    let dx = striker.x - e.offsetX;
    let dy = striker.y - e.offsetY;
    let length = Math.hypot(dx, dy);
    let force = Math.min(length/10, 6); // limit max speed
    striker.dx = (dx/length)*force;
    striker.dy = (dy/length)*force;
  }
};

function collide(b1, b2){
  let dx=b2.x-b1.x;
  let dy=b2.y-b1.y;
  let dist=Math.hypot(dx,dy);
  let minDist=b1.radius+b2.radius;
  if(dist<minDist && dist>0){
    let overlap = (minDist - dist) / 2;
    let nx = dx/dist;
    let ny = dy/dist;
    b1.x -= nx*overlap;
    b1.y -= ny*overlap;
    b2.x += nx*overlap;
    b2.y += ny*overlap;

    let vx=b1.dx - b2.dx;
    let vy=b1.dy - b2.dy;
    let dot= vx*nx + vy*ny;
    b1.dx -= dot*nx;
    b1.dy -= dot*ny;
    b2.dx += dot*nx;
    b2.dy += dot*ny;
  }
}

function update() {
  allBalls.forEach(ball=>{
    ball.x += ball.dx;
    ball.y += ball.dy;
    ball.dx *=0.98;
    ball.dy *=0.98;
    if(Math.abs(ball.dx)<0.05) ball.dx=0;
    if(Math.abs(ball.dy)<0.05) ball.dy=0;

    if(ball.x - ball.radius < 0){ ball.x=ball.radius; ball.dx=-ball.dx; }
    if(ball.x + ball.radius > 400){ ball.x=400-ball.radius; ball.dx=-ball.dx; }
    if(ball.y - ball.radius < 0){ ball.y=ball.radius; ball.dy=-ball.dy; }
    if(ball.y + ball.radius > 400){ ball.y=400-ball.radius; ball.dy=-ball.dy; }
  });

  for(let i=0;i<allBalls.length;i++){
    for(let j=i+1;j<allBalls.length;j++){
      collide(allBalls[i], allBalls[j]);
    }
  }

  let pockets = [[0,0],[400,0],[0,400],[400,400]];
  coins = coins.filter(c=>{
    let pocketed=false;
    pockets.forEach(p=>{
      if(Math.hypot(c.x-p[0],c.y-p[1])<28){ pocketed=true; score+=1; }
    });
    return !pocketed;
  });
  allBalls = [striker, ...coins];
  scoreEl.innerText="Score: "+score;

  if(coins.length===0){
    canvas.style.display='none';
    scoreEl.style.display='none';
    winEl.style.display='block';
  }
}

function drawBoard(){
  ctx.clearRect(0,0,400,400);

  ctx.fillStyle='#deb887';
  ctx.fillRect(0,0,400,400);

  ctx.strokeStyle='#8b4513';
  ctx.lineWidth=6;
  ctx.strokeRect(10,10,380,380);

  ctx.strokeStyle='#654321';
  ctx.lineWidth=3;
  ctx.strokeRect(40,40,320,320);

  ctx.beginPath();
  ctx.arc(200,200,20,0,Math.PI*2);
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(200,40); ctx.lineTo(200,360);
  ctx.moveTo(40,200); ctx.lineTo(360,200);
  ctx.stroke();

  ctx.fillStyle='#000';
  [[0,0],[400,0],[0,400],[400,400]].forEach(p=>{
    ctx.beginPath();
    ctx.arc(p[0],p[1],28,0,Math.PI*2);
    ctx.fill();
  });
}

function draw(){
  drawBoard();
  coins.forEach(c=>{
    ctx.beginPath();
    ctx.arc(c.x,c.y,c.radius,0,Math.PI*2);
    ctx.fillStyle=c.color;
    ctx.fill();
  });
  ctx.beginPath();
  ctx.arc(striker.x,striker.y,striker.radius,0,Math.PI*2);
  ctx.fillStyle=striker.color;
  ctx.fill();
  ctx.lineWidth=2;
  ctx.strokeStyle=striker.border;
  ctx.stroke();

  if(dragging){
    ctx.strokeStyle='cyan';
    ctx.beginPath();
    ctx.moveTo(striker.x,striker.y);
    ctx.lineTo(dragStart.x,dragStart.y);
    ctx.stroke();
  }
}

function loop(){
  if(coins.length>0){
    update();
    draw();
    requestAnimationFrame(loop);
  }
}
</script>

</body>
</html>
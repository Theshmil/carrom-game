<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Carrom Game</title>
<style>
  body {
    margin: 0;
    background: #3e2723;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #fff;
    font-family: sans-serif;
  }
  h1 { margin: 10px; }
  canvas {
    background: #deb887;
    border: 8px solid #5d4037;
    border-radius: 20px;
    touch-action: none;
  }
  .menu button {
    margin: 5px;
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    background: #795548;
    color: white;
    cursor: pointer;
  }
  .menu button:hover { background: #5d4037; }
</style>
</head>
<body>
<h1>Carrom</h1>
<div class="menu">
  <button onclick="startGame()">Local Play</button>
  <button onclick="alert('AI coming soon!')">AI ðŸ¤–</button>
  <button onclick="alert('Created by Treadmil and Sofa')">About</button>
</div>
<canvas id="gameCanvas" width="500" height="500"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let striker, pucks, isDragging = false, dragStart = null, dragEnd = null;

function startGame() {
  striker = { x: 250, y: 450, radius: 12, dx: 0, dy: 0, color: "#222" };
  pucks = [
    { x: 250, y: 250, radius: 14, color: "red", dx: 0, dy: 0 },
    { x: 230, y: 230, radius: 14, color: "black", dx: 0, dy: 0 },
    { x: 270, y: 230, radius: 14, color: "white", dx: 0, dy: 0 },
    { x: 230, y: 270, radius: 14, color: "white", dx: 0, dy: 0 },
    { x: 270, y: 270, radius: 14, color: "black", dx: 0, dy: 0 }
  ];
}

function drawBoard() {
  ctx.clearRect(0,0,500,500);
  ctx.fillStyle = "#deb887";
  ctx.fillRect(0,0,500,500);
  // pockets
  ctx.fillStyle="#000";
  [[0,0],[500,0],[0,500],[500,500]].forEach(([x,y])=>{
    ctx.beginPath(); ctx.arc(x,y,20,0,Math.PI*2); ctx.fill();
  });
  // guide line
  if (isDragging && dragStart && dragEnd) {
    ctx.strokeStyle="rgba(255,255,255,0.8)";
    ctx.beginPath();
    ctx.moveTo(striker.x,striker.y);
    ctx.lineTo(dragEnd.x,dragEnd.y);
    ctx.stroke();
  }
}

function drawPuck(p) {
  ctx.fillStyle = p.color;
  ctx.beginPath(); ctx.arc(p.x,p.y,p.radius,0,Math.PI*2); ctx.fill();
}

function draw() {
  drawBoard();
  pucks.forEach(drawPuck);
  drawPuck(striker);
}

function update() {
  // move striker
  striker.x += striker.dx; striker.y += striker.dy;
  striker.dx *= 0.98; striker.dy *= 0.98;
  if (Math.abs(striker.dx)<0.1) striker.dx=0;
  if (Math.abs(striker.dy)<0.1) striker.dy=0;

  // collisions
  pucks.forEach(p=>{
    let dx = p.x - striker.x;
    let dy = p.y - striker.y;
    let dist = Math.hypot(dx,dy);
    if(dist < p.radius+striker.radius){
      let angle = Math.atan2(dy, dx);
      let overlap = p.radius+striker.radius - dist;
      striker.x -= Math.cos(angle)*overlap/2;
      striker.y -= Math.sin(angle)*overlap/2;
      p.x += Math.cos(angle)*overlap/2;
      p.y += Math.sin(angle)*overlap/2;
      // swap speeds
      [striker.dx, p.dx] = [p.dx || 0, striker.dx];
      [striker.dy, p.dy] = [p.dy || 0, striker.dy];
    }
  });

  draw();
  requestAnimationFrame(update);
}

// drag control
canvas.addEventListener("mousedown", e=>{
  isDragging=true;
  const rect=canvas.getBoundingClientRect();
  dragStart={x:e.clientX - rect.left, y:e.clientY - rect.top};
  dragEnd=dragStart;
});
canvas.addEventListener("mousemove", e=>{
  if(isDragging){
    const rect=canvas.getBoundingClientRect();
    dragEnd={x:e.clientX - rect.left, y:e.clientY - rect.top};
  }
});
canvas.addEventListener("mouseup", e=>{
  if(isDragging && dragStart && dragEnd){
    let dx=dragStart.x - dragEnd.x;
    let dy=dragStart.y - dragEnd.y;
    striker.dx=dx*0.15;
    striker.dy=dy*0.15;
  }
  isDragging=false;
  dragStart=dragEnd=null;
});

startGame();
update();
</script>
</body>
</html>
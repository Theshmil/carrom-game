<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Carrom Game</title>
<style>
  body {
    margin: 0;
    background: #3e2723;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #fff;
    font-family: sans-serif;
  }
  h1 { margin: 10px; }
  canvas {
    background: #deb887;
    border: 8px solid #5d4037;
    border-radius: 20px;
    touch-action: none;
  }
  .menu, .scoreboard {
    margin: 10px;
  }
  .menu button {
    margin: 5px;
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    background: #795548;
    color: white;
    cursor: pointer;
  }
  .menu button:hover { background: #5d4037; }
</style>
</head>
<body>
<h1>Carrom</h1>
<div class="menu">
  <button onclick="startGame('local')">Local Play</button>
  <button onclick="alert('AI coming soon!')">AI ðŸ¤–</button>
  <button onclick="alert('Created by Treadmil and Sofa')">About</button>
</div>
<div class="scoreboard">Score: <span id="score">0</span></div>
<canvas id="gameCanvas" width="500" height="500"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let striker, pucks, isDragging = false, dragStart = null, dragEnd = null, score = 0;

function startGame(mode) {
  striker = { x: 250, y: 450, radius: 12, dx: 0, dy: 0, color: "#222" };
  pucks = [];
  const radius = 14;
  const center = { x: 250, y: 250 };
  // Queen
  pucks.push({ x: center.x, y: center.y, radius, color: "red", dx: 0, dy: 0 });
  // Black & White pucks
  for (let i=0;i<4;i++)
    pucks.push({ x:center.x+(i-1.5)*30, y:center.y-30, radius, color:"black", dx:0, dy:0 });
  for (let i=0;i<4;i++)
    pucks.push({ x:center.x+(i-1.5)*30, y:center.y+30, radius, color:"white", dx:0, dy:0 });
  score = 0;
  document.getElementById("score").textContent = score;
}

function drawBoard() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // Pockets
  ctx.fillStyle="#000";
  [[0,0],[500,0],[0,500],[500,500]].forEach(([x,y])=>{
    ctx.beginPath(); ctx.arc(x,y,20,0,Math.PI*2); ctx.fill();
  });
  // Border & baselines
  ctx.strokeStyle="#5d4037"; ctx.lineWidth=4; ctx.strokeRect(40,40,420,420);
  ctx.lineWidth=2; ctx.strokeRect(60,60,380,380);
  // Center circle
  ctx.beginPath(); ctx.arc(250,250,30,0,Math.PI*2); ctx.stroke();
  ctx.fillStyle="#b71c1c"; ctx.beginPath(); ctx.arc(250,250,5,0,Math.PI*2); ctx.fill();
  // Drag line
  if (isDragging && dragStart && dragEnd) {
    ctx.strokeStyle="rgba(255,255,255,0.8)";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(striker.x,striker.y);
    ctx.lineTo(dragEnd.x,dragEnd.y);
    ctx.stroke();
  }
}

function drawPuck(p) {
  ctx.fillStyle = p.color;
  ctx.beginPath(); ctx.arc(p.x,p.y,p.radius,0,Math.PI*2); ctx.fill();
}

function draw() {
  drawBoard();
  pucks.forEach(drawPuck);
  drawPuck(striker);
}

function updatePhysics() {
  [...pucks, striker].forEach(p=>{
    p.x += p.dx; p.y += p.dy;
    p.dx *= 0.98; p.dy *=0.98;
    if (Math.abs(p.dx)<0.05) p.dx=0;
    if (Math.abs(p.dy)<0.05) p.dy=0;
    // Walls
    if (p.x - p.radius <0 || p.x + p.radius>500) { p.x=Math.max(p.radius,Math.min(500-p.radius,p.x)); p.dx=-p.dx; }
    if (p.y - p.radius <0 || p.y + p.radius>500) { p.y=Math.max(p.radius,Math.min(500-p.radius,p.y)); p.dy=-p.dy; }
  });
  // Collisions
  let all = [striker,...pucks];
  for (let i=0;i<all.length;i++) {
    for (let j=i+1;j<all.length;j++) {
      let a=all[i], b=all[j];
      let dx=b.x-a.x, dy=b.y-a.y, dist=Math.hypot(dx,dy);
      if (dist<a.radius+b.radius) {
        let overlap=(a.radius+b.radius)-dist;
        let nx=dx/dist, ny=dy/dist;
        a.x -= nx*overlap/2; a.y -= ny*overlap/2;
        b.x += nx*overlap/2; b.y += ny*overlap/2;
        // swap speed
        [a.dx,b.dx]=[b.dx,a.dx]; [a.dy,b.dy]=[b.dy,a.dy];
      }
    }
  }
  // Pocket detection
  for (let i=pucks.length-1;i>=0;i--) {
    let p=pucks[i];
    if (inPocket(p)) { pucks.splice(i,1); score+=10; document.getElementById("score").textContent=score; }
  }
}

function inPocket(p) {
  return (
    (p.x<20 && p.y<20) || (p.x>480 && p.y<20) ||
    (p.x<20 && p.y>480) || (p.x>480 && p.y>480)
  );
}

function gameLoop() {
  updatePhysics();
  draw();
  requestAnimationFrame(gameLoop);
}

// Handle drag using clientX/Y
canvas.addEventListener("mousedown", e=>{
  isDragging=true;
  dragStart={x:e.clientX - canvas.getBoundingClientRect().left, y:e.clientY - canvas.getBoundingClientRect().top};
  dragEnd=dragStart;
});
canvas.addEventListener("mousemove", e=>{
  if(isDragging) {
    dragEnd={x:e.clientX - canvas.getBoundingClientRect().left, y:e.clientY - canvas.getBoundingClientRect().top};
  }
});
canvas.addEventListener("mouseup", e=>{
  if (isDragging && dragStart && dragEnd) {
    let dx=dragStart.x - dragEnd.x;
    let dy=dragStart.y - dragEnd.y;
    striker.dx=dx*0.15;
    striker.dy=dy*0.15;
  }
  isDragging=false;
  dragStart=dragEnd=null;
});

startGame('local');
gameLoop();
</script>
</body>
</html>
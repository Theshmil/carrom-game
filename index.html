<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Carrom Pool</title>
<style>
  body { margin:0; background:#111; color:#fff; font-family:sans-serif; text-align:center; }
  canvas { background:#d2b48c; border:8px solid #fff; border-radius:20px; touch-action:none; }
  #menu { margin-top:30px; }
  #menu button { margin:10px; padding:12px 25px; font-size:18px; background:#fff; color:#000; border:none; border-radius:10px; cursor:pointer; }
  #sliderContainer { margin-top:10px; display:none; }
  input[type=range] { width:200px; }
  #winMessage, #aboutBox { position:absolute; top:40%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.8); padding:20px; border-radius:10px; font-size:20px; display:none; }
</style>
</head>
<body>
<h1>Carrom Pool</h1>
<div id="menu">
  <button onclick="startGame('local')">Local Multiplayer</button>
  <button onclick="startGame('ai')">Play vs AI ü§ñ</button>
  <button onclick="showAbout()">About</button>
</div>
<canvas id="gameCanvas" width="400" height="400" style="display:none;"></canvas>
<div id="sliderContainer">
  <input type="range" id="strikerSlider" min="60" max="340" value="200">
</div>
<div id="winMessage">üéâ You Win! <button onclick="restartGame()">Play Again</button></div>
<div id="aboutBox">Created by Theshmil & Sofa ‚ù§Ô∏è<br><br><button onclick="closeAbout()">Close</button></div>

<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
const slider=document.getElementById('strikerSlider');
let striker={x:200,y:360,r:12,vx:0,vy:0};
let pucks=[], dragging=false, dragStart=null, dragEnd=null;
let mode='', turn=0; // 0: player1, 1: player2
let waitingForNextTurn=true;

function initPucks(){
  pucks=[];
  const pos=[{x:200,y:200},{x:215,y:200},{x:185,y:200},{x:200,y:215},{x:200,y:185},{x:215,y:215},{x:185,y:185},{x:215,y:185},{x:185,y:215}];
  pos.forEach((p,i)=>pucks.push({x:p.x,y:p.y,r:10,color:i==0?'red':i%2==0?'white':'black',vx:0,vy:0}));
}

function restartGame(){
  striker.x=200; striker.y=360; striker.vx=0; striker.vy=0;
  slider.value=200; turn=0; waitingForNextTurn=true;
  initPucks();
  document.getElementById('winMessage').style.display='none';
  slider.style.display='block';
}

function startGame(selected){
  mode=selected;
  document.getElementById('menu').style.display='none';
  canvas.style.display='block';
  restartGame();
}

function showAbout(){document.getElementById('aboutBox').style.display='block';}
function closeAbout(){document.getElementById('aboutBox').style.display='none';}

slider.addEventListener('input',()=>{ if(waitingForNextTurn){ striker.x=+slider.value; } });

function getPos(e){
  const rect=canvas.getBoundingClientRect();
  if(e.touches) e=e.touches[0];
  return {x:e.clientX-rect.left,y:e.clientY-rect.top};
}

canvas.addEventListener('mousedown',e=>{if(waitingForNextTurn&&isNearStriker(getPos(e))){dragging=true; dragStart=getPos(e); dragEnd=dragStart;}});
canvas.addEventListener('mousemove',e=>{if(dragging) dragEnd=getPos(e);});
canvas.addEventListener('mouseup',e=>{if(dragging){shoot();} dragging=false;});
canvas.addEventListener('touchstart',e=>{if(waitingForNextTurn&&isNearStriker(getPos(e))){dragging=true; dragStart=getPos(e); dragEnd=dragStart;}});
canvas.addEventListener('touchmove',e=>{if(dragging){dragEnd=getPos(e); e.preventDefault();}});
canvas.addEventListener('touchend',e=>{if(dragging){shoot();} dragging=false;});

function isNearStriker(pos){return Math.hypot(pos.x-striker.x,pos.y-striker.y)<striker.r+10;}
function shoot(){
  const dx=dragEnd.x-dragStart.x, dy=dragEnd.y-dragStart.y, len=Math.hypot(dx,dy);
  if(len>5){ 
    striker.vx=-(dx/len)*6; striker.vy=-(dy/len)*6; 
    slider.style.display='none'; 
    waitingForNextTurn=false;
  }
}

function collide(a,b){
  let dx=b.x - a.x, dy=b.y - a.y, dist=Math.hypot(dx,dy);
  if(dist< a.r+b.r){
    let nx=dx/dist, ny=dy/dist;
    let p=2*((a.vx*nx+a.vy*ny)-(b.vx*nx+b.vy*ny))/2;
    a.vx -= p*nx; a.vy -= p*ny; b.vx += p*nx; b.vy += p*ny;
    let overlap=(a.r+b.r-dist)/2; a.x-=nx*overlap; a.y-=ny*overlap; b.x+=nx*overlap; b.y+=ny*overlap;
  }
}

function allStopped(){
  return Math.abs(striker.vx)<0.1&&Math.abs(striker.vy)<0.1 && pucks.every(p=>Math.abs(p.vx)<0.1&&Math.abs(p.vy)<0.1);
}

function physics(){
  [striker,...pucks].forEach(obj=>{
    obj.x+=obj.vx; obj.y+=obj.vy;
    obj.vx*=0.98; obj.vy*=0.98;
    if(Math.abs(obj.vx)<0.05) obj.vx=0;
    if(Math.abs(obj.vy)<0.05) obj.vy=0;
    if(obj.x<obj.r){obj.x=obj.r; obj.vx*=-1;}
    if(obj.x>400-obj.r){obj.x=400-obj.r; obj.vx*=-1;}
    if(obj.y<obj.r){obj.y=obj.r; obj.vy*=-1;}
    if(obj.y>400-obj.r){obj.y=400-obj.r; obj.vy*=-1;}
  });
  pucks.forEach(p=>collide(striker,p));
  for(let i=0;i<pucks.length;i++) for(let j=i+1;j<pucks.length;j++) collide(pucks[i],pucks[j]);

  if(!waitingForNextTurn && allStopped()){ 
    // next player's turn
    turn=1-turn; striker.y=turn==0?360:40; slider.value=striker.x;
    slider.style.display='block'; waitingForNextTurn=true;
  }
}

function drawBoard(){
  ctx.fillStyle='#d2b48c'; ctx.fillRect(0,0,400,400);
  ctx.strokeStyle='brown'; ctx.lineWidth=2;
  ctx.beginPath(); ctx.arc(200,200,50,0,2*Math.PI); ctx.stroke();
  ctx.beginPath(); ctx.arc(200,200,30,0,2*Math.PI); ctx.stroke();
  ctx.beginPath(); ctx.arc(200,200,10,0,2*Math.PI); ctx.stroke();
  ctx.moveTo(50,50); ctx.lineTo(350,350); ctx.moveTo(350,50); ctx.lineTo(50,350); ctx.stroke();
}

function draw(){
  ctx.clearRect(0,0,400,400);
  drawBoard();
  [0,400].forEach(x=>[0,400].forEach(y=>{
    ctx.beginPath(); ctx.arc(x,y,20,0,2*Math.PI); ctx.fillStyle='#000'; ctx.fill();
  }));
  pucks.forEach(p=>{
    ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,2*Math.PI); ctx.fillStyle=p.color; ctx.fill();
  });
  ctx.beginPath(); ctx.arc(striker.x,striker.y,striker.r,0,2*Math.PI); ctx.fillStyle='navy'; ctx.fill();
  if(dragging){
    ctx.strokeStyle='yellow'; ctx.beginPath(); ctx.moveTo(striker.x,striker.y); ctx.lineTo(dragEnd.x,dragEnd.y); ctx.stroke();
  }
}

function loop(){ if(mode){ physics(); draw(); } requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>